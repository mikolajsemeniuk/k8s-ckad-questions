apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# =========================
# 1锔 resources
# =========================
# Lista manifest贸w Kubernetes, kt贸re Kustomize ma wzi jako baz.
# Mog to by:
# - pliki YAML
# - katalogi (z innym kustomization.yaml)
resources:
  - deployment.yaml
  - service.yaml
  - pvc.yaml

# =========================
# 2锔 namePrefix / nameSuffix
# =========================
# Dodaje prefiks/sufiks do NAZW WSZYSTKICH zasob贸w.
# Bardzo czste na CKA do rozr贸偶niania rodowisk.
namePrefix: prod-
nameSuffix: -v1

# =========================
# 3锔 namespace
# =========================
# Ustawia namespace dla wszystkich zasob贸w,
# nawet jeli w oryginalnych YAML-ach go nie ma.
namespace: production

# =========================
# 4锔 labels
# =========================
# Dodaje (lub nadpisuje) labels we WSZYSTKICH zasobach.
# Przydatne do:
# - selektor贸w
# - NetworkPolicy
# - monitoringu
labels:
  - pairs:
      environment: production
      app: my-app

# =========================
# 5锔 images
# =========================
# Pozwala zmieni image / tag BEZ edycji Deployment.yaml.
# Kustomize znajdzie wszystkie wystpienia tego image.
images:
  - name: nginx
    newName: nginx
    newTag: "1.25"

# =========================
# 6锔 replicas
# =========================
# Ustawia liczb replik dla konkretnego Deploymentu.
# Bardzo czste zadanie egzaminacyjne.
replicas:
  - name: web
    count: 3

# =========================
# 7锔 configMapGenerator
# =========================
# Generuje ConfigMap automatycznie.
# Kustomize:
# - doda hash do nazwy
# - automatycznie podmieni referencje w Podach
configMapGenerator:
  - name: app-config
    literals:
      - LOG_LEVEL=info
      - FEATURE_X=true

# =========================
# 8锔 secretGenerator
# =========================
# Generuje Secret (domylnie type Opaque).
# Na CKA czsto u偶ywane zamiast rcznego pisania Secret贸w.
secretGenerator:
  - name: app-secret
    literals:
      - password=supersecret

# =========================
# 9锔 patchesStrategicMerge
# =========================
# Najczciej u偶ywany patch na CKA.
# Nadpisuje TYLKO wskazane pola.
# Patch musi zawiera:
# - apiVersion
# - kind
# - metadata.name
patchesStrategicMerge:
  - patch-replicas.yaml
  - patch-resources.yaml

# =========================
#  patches (JSON 6902)
# =========================
# Bardziej precyzyjny patch (operacje replace/add/remove).
# Rzadziej, ale czasem potrzebny.
patches:
  - target:
      kind: Deployment
      name: web
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: "500m"

# =========================
# 1锔1锔 commonAnnotations
# =========================
# Dodaje annotations do wszystkich zasob贸w.
# Czsto u偶ywane do metadanych lub narzdzi CI/CD.
commonAnnotations:
  managed-by: kustomize
